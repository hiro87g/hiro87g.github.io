// Mid pointvar latlng = new google.maps.LatLng(36.3814822, 139.222185);var options = {    zoom: 3,    center: latlng,    mapTypeId: google.maps.MapTypeId.ROADMAP};var map = new google.maps.Map(document.getElementById("map"), options);var counter = 0;var marker1, marker2, marker3;var lat1, lng1, lat2, lng2, lat3, lng3;var getlat1, getlng1, getlat2, getlng2;function midPoint() {    if (document.getElementById('address1').value != "" && document.getElementById('address2').value != "") {        $("#loading").show();        if (counter > 0) {            marker1.setMap(null);            marker2.setMap(null);            marker3.setMap(null);        }        counter = counter + 1;        //住所１のジオコード        var geocoder = new google.maps.Geocoder();        geocoder.geocode({            'address': document.getElementById('address1').value        }, function (result, status) {            if (status == google.maps.GeocoderStatus.OK) {                             //緯度と軽度を取得                lat1 = result[0].geometry.location.lat();                lng1 = result[0].geometry.location.lng();                //ピンを設置                var pin_a = 'img/pin_a.png';                marker1 = new google.maps.Marker({                    position: result[0].geometry.location,                    map: map,                    icon: pin_a                });                getBpoint();            } else {                navigator.notification.alert("A地点に該当する場所が見つかりませんでした。", function () {}, " ", "OK")                counter = 0;                $("#loading").hide();                return false;            }        });        function getBpoint() {            //住所2のジオコード            var geocoder2 = new google.maps.Geocoder();            geocoder2.geocode({                'address': document.getElementById('address2').value            }, function (result, status) {                if (status == google.maps.GeocoderStatus.OK) {                    //緯度と軽度を取得                    lat2 = result[0].geometry.location.lat();                    lng2 = result[0].geometry.location.lng();                    　　　　　                   //ピンを設置                   var pin_b = 'img/pin_b.png';                   marker2 = new google.maps.Marker({                    position: result[0].geometry.location,                    map: map,                    icon: pin_b                });                   getMidpoint();               } else {                navigator.notification.alert("B地点に該当する場所が見つかりませんでした。", function () {}, " ", "OK")                counter = 0;                $("#loading").hide();                return false;            }            $("#loading").hide();        });        }        function getMidpoint() {            //中間地点の緯度経度を取得            if (lat1 > lat2) {                diff_lat = (lat1 - lat2) / 2;                lat3 = lat2 + diff_lat;            } else {                diff_lat = (lat2 - lat1) / 2;                lat3 = lat1 + diff_lat;            }            if (lng1 > lng2) {                diff_lng = (lng1 - lng2) / 2;                lng3 = lng2 + diff_lng;            } else {                diff_lng = (lng2 - lng1) / 2;                lng3 = lng1 + diff_lng;            }            //中間地点の逆ジオコード            var geocoder3 = new google.maps.Geocoder();            geocoder3.geocode({                latLng: new google.maps.LatLng(lat3, lng3),            }, function (results, status) {                if (status == google.maps.GeocoderStatus.OK) {                    // 住所を取得(日本の場合だけ「日本, 」を削除)                    var address = results[0].formatted_address.replace(/^日本, /, '');                    document.getElementById('put_mp_result').innerHTML = address;                } else {                    navigator.notification.alert("Error! reason: " + status, function () {}, " ", "OK")                    return false;                }            });            //中間地点に向けて拡大            map.panTo(new google.maps.LatLng(lat3, lng3));            map.setZoom(12);            var pin_mp = 'img/pin_mp2.png';            marker3 = new google.maps.Marker({                position: new google.maps.LatLng(lat3, lng3),                map: map,                icon: pin_mp            });            //express.heartrailsAPIを利用                heartrailsURL = "http://express.heartrails.com/api/json?method=getStations&";            heartrailsURL += "x=" + lng3 + "&";            heartrailsURL += "y=" + lat3 + "&";            heartrailsURL += "jsonp=getStation";            //JSONPのコールバック関数            var script = document.createElement('script');            script.src = heartrailsURL;            document.body.appendChild(script);        }    } else {        navigator.notification.alert("A地点、B地点の両方に\n入力してください。", function() {}, " ", "OK")    }}function getStation(result) {    var resultStr = "";    for (i = 0; i < result["response"]["station"].length; i++) {        resultStr += result["response"]["station"][i].line + " ";        resultStr += result["response"]["station"][i].name + "駅";        resultStr += "：" + result["response"]["station"][i].distance + "<br>";        resultStr += "<a href='https://maps.google.com/maps?dirflg=t&ttype=now&sort=def&saddr=" + document.getElementById('address1').value + "&daddr=" + result["response"]["station"][i].line + result["response"]["station"][i].name + "駅" + "'>Aからの乗換案内</a>";        resultStr += "<a href='https://maps.google.com/maps?dirflg=t&ttype=now&sort=def&saddr=" + document.getElementById('address2').value + "&daddr=" + result["response"]["station"][i].line + result["response"]["station"][i].name + "駅" + "'>Bからの乗換案内</a><div class='line'></div>";    }    document.getElementById('put_result').innerHTML = resultStr;    //リンク先を全てインブラウザで開く    var all = document.all;    var n = all.length;    for (i = 0; i < n; ++i) {        var el = all(i);        var tag = el.tagName;        if (tag == "A") {            el.onclick = inbrowser;        }    }    $("#loading").hide();}